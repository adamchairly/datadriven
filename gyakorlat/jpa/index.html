
<!DOCTYPE html>

<html class="no-js" lang="hu">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Albert István, Tóth Tibor" name="author"/>
<link href="../mongodb/" rel="prev"/>
<link href="../rest/" rel="next"/>
<link href="../../img/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.9" name="generator"/>
<title>JPA &amp; Spring Data - BMEVIAUAC01 Adatvezérelt rendszerek</title>
<link href="../../assets/stylesheets/main.0d440cfe.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../css/timeago.css" rel="stylesheet"/>
<link href="../../extra-material-theme.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="red" data-md-color-primary="aut" data-md-color-scheme="aut" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#jpa-spring-data">
          Kihagyás
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Élőfej" class="md-header__inner md-grid">
<a aria-label="BMEVIAUAC01 Adatvezérelt rendszerek" class="md-header__button md-logo" data-md-component="logo" href="../.." title="BMEVIAUAC01 Adatvezérelt rendszerek">
<img alt="logo" src="../../img/logo-bme-aut.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            BMEVIAUAC01 Adatvezérelt rendszerek
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              JPA &amp; Spring Data
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Váltás sötét témára" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="aut" data-md-color-scheme="aut" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Váltás sötét témára">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"></path></svg>
</label>
<input aria-label="Váltás világos témára" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="red" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Váltás világos témára">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Keresés" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Keresés" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Keresés" class="md-search__options">
<button aria-label="Törlés" class="md-search__icon md-icon" tabindex="-1" title="Törlés" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Keresés inicializálása
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/bmeviauac01/adatvezerelt" title="Főoldalra ugrás">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    bmeviauac01/adatvezerelt
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Lapok" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
      Adatvezérelt rendszerek
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../db/">
        Adatbázis
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../jegyzet/architektura/">
        Jegyzetek
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../transactions/">
        Gyakorlatok
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../hazi/">
        Házi feladatok
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigáció" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="BMEVIAUAC01 Adatvezérelt rendszerek" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="BMEVIAUAC01 Adatvezérelt rendszerek">
<img alt="logo" src="../../img/logo-bme-aut.png"/>
</a>
    BMEVIAUAC01 Adatvezérelt rendszerek
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/bmeviauac01/adatvezerelt" title="Főoldalra ugrás">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    bmeviauac01/adatvezerelt
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Adatvezérelt rendszerek
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Adatbázis
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Adatbázis
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../db/">
        Minta adatbázis sémája
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../db/mssql/">
        Microsoft SQL Server használata
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../db/mongodb/">
        MongoDB használata
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql">
        Minta adatbázis: mssql.sql
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mongo.js">
        Minta adatbázis: mongo.js
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Jegyzetek
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Jegyzetek
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/architektura/">
        Adatvezérelt rendszerek és a többrétegű (háromrétegű) architektúra
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/transactions/">
        Tranzakciókezelés adatbázisokban
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/mssql/sql/">
        SQL nyelv, MSSQL platformfüggő SQL utasítások
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/mssql/server-side-programming/">
        Microsoft SQL Server programozása
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/adonet/">
        ADO.NET adatelérés
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/linq/">
        LINQ: Language Integrated Query
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/ef/">
        Kapcsolatok definiálása Entity Framework-ben
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/mongodb/">
        MongoDB alapok, műveletek, és a MongoDB .NET Driver
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/di/">
        Függőséginjektálás ASP.NET Core környezetben
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/async/">
        Aszinkron kérések és DTO-k (példa WebAPI alkalmazás)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../jegyzet/openapi/">
        OpenAPI 3 és a Swagger
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://github.com/bmeviauac01/rest-webapi-sample">
        REST és WebAPI demó alkalmazás (GitHub)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://github.com/bmeviauac01/todoapi-di-sample">
        ASP.NET Core DI demó alkalmazás (GitHub)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://github.com/bmeviauac01/threelayered-aspnetcore-sample">
        Minta többrétegű webalkalmazás (GitHub)
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Gyakorlatok
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Gyakorlatok
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../transactions/">
        Tranzakciókezelés
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mssql/">
        Microsoft SQL Server programozása
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ef/">
        Entity Framework
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mongodb/">
        MongoDB
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          JPA &amp; Spring Data
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        JPA &amp; Spring Data
      </a>
<nav aria-label="Tartalomjegyzék" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#elofeltetelek">
    Előfeltételek
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#amit-erdemes-atnezned">
    Amit érdemes átnézned
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gyakorlat-menete">
    Gyakorlat menete
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tippek-az-ide-hasznalatahoz">
    Tippek az IDE használatához
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-0-adatbazis-letrehozasa">
    Feladat 0: Adatbázis létrehozása
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-1-ide-inditasa">
    Feladat 1: IDE indítása
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-2-projekt-importalasa">
    Feladat 2: Projekt importálása
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-3-entitasok-attekintese">
    Feladat 3: Entitások áttekintése
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-4-lekerdezesek">
    Feladat 4: Lekérdezések
  </a>
<nav aria-label="Feladat 4: Lekérdezések" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#futtatas">
    Futtatás
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-5-adatmodositas">
    Feladat 5: Adatmódosítás
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-6-tarolt-eljarasok-hasznalata">
    Feladat 6: Tárolt eljárások használata
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../rest/">
        REST API &amp; ASP.NET Web API
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Házi feladatok
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Házi feladatok
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/">
        Szorgalmi házi feladatok
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/mssql/">
        Feladat: MSSQL szerveroldali programozás
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/adonet/">
        Feladat: ADO.NET adatelérés
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/ef/">
        Feladat: Entity Framework
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/mongodb/">
        Feladat: MongoDB
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/rest/">
        Feladat: REST API Web API technológiával
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/GitHub/">
        Feladatok beadása (GitHub)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/GitHub-Actions/">
        GitHub Actions ismertető
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hazi/VisualStudio/">
        Visual Studio &amp; .NET SDK telepítése
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Tartalomjegyzék" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#elofeltetelek">
    Előfeltételek
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#amit-erdemes-atnezned">
    Amit érdemes átnézned
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gyakorlat-menete">
    Gyakorlat menete
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tippek-az-ide-hasznalatahoz">
    Tippek az IDE használatához
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-0-adatbazis-letrehozasa">
    Feladat 0: Adatbázis létrehozása
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-1-ide-inditasa">
    Feladat 1: IDE indítása
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-2-projekt-importalasa">
    Feladat 2: Projekt importálása
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-3-entitasok-attekintese">
    Feladat 3: Entitások áttekintése
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-4-lekerdezesek">
    Feladat 4: Lekérdezések
  </a>
<nav aria-label="Feladat 4: Lekérdezések" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#futtatas">
    Futtatás
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-5-adatmodositas">
    Feladat 5: Adatmódosítás
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feladat-6-tarolt-eljarasok-hasznalata">
    Feladat 6: Tárolt eljárások használata
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/bmeviauac01/adatvezerelt/edit/master/docs/gyakorlat/jpa/index.md" title="Oldal szerkesztése">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"></path></svg>
</a>
<h1 id="jpa-spring-data">JPA &amp; Spring Data<a class="headerlink" href="#jpa-spring-data" title="Permanent link">¶</a></h1>
<p>A gyakorlat célja, hogy a hallgatók megismerjék a JPA és a Spring Data használatát. A főbb témák: entitások fejlesztése, lekérdezések megfogalmazása különböző módokon, módosítások végrehajtása. A kódokat egy webalkalmazás projektbe integráljuk, amiben a projekt alapvető konfigurációja és egy teszteléshez használható egyszerű webes felületet már készen áll.</p>
<h2 id="elofeltetelek">Előfeltételek<a class="headerlink" href="#elofeltetelek" title="Permanent link">¶</a></h2>
<p>A labor elvégzéséhez szükséges eszközök:</p>
<ul>
<li>Spring Tool Suite (Eclipse alapú IDE)</li>
<li>Microsoft SQL Server Express edition (localdb ezúttal <strong>nem</strong> jó)</li>
<li>SQL Server Management Studio</li>
<li>Adatbázis létrehozó script: <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql">mssql.sql</a></li>
<li>Kiinduló webalkalmazás kódja: <a href="https://github.com/bmeviauac01/gyakorlat-jpa-kiindulo">https://github.com/bmeviauac01/gyakorlat-jpa-kiindulo</a></li>
</ul>
<h2 id="amit-erdemes-atnezned">Amit érdemes átnézned<a class="headerlink" href="#amit-erdemes-atnezned" title="Permanent link">¶</a></h2>
<ul>
<li>JPA előadás</li>
<li>EJB, Spring előadás</li>
</ul>
<h2 id="gyakorlat-menete">Gyakorlat menete<a class="headerlink" href="#gyakorlat-menete" title="Permanent link">¶</a></h2>
<p>A gyakorlat végig vezetett, a gyakorlatvezető utasításai szerint haladjunk. Egy-egy részfeladatot próbáljunk meg először önállóan megoldani, utána beszéljük meg a megoldást közösen. Az utolsó feladat opcionális, ha belefér az időbe.</p>
<div class="admonition info">
<p>Emlékeztetőként a megoldások is megtalálhatóak az útmutatóban is. Előbb azonban próbáljuk magunk megoldani a feladatot!</p>
</div>
<h2 id="tippek-az-ide-hasznalatahoz">Tippek az IDE használatához<a class="headerlink" href="#tippek-az-ide-hasznalatahoz" title="Permanent link">¶</a></h2>
<ul>
<li>Típus (osztály, interfész, enum) keresése: Ctrl+Shift+T (Nem érdemes a Project explorer-ben a mappákat nyitogatni)</li>
<li>Fájl keresése: Ctrl+Shift+R</li>
<li>Hiányzó importok megjavítása: Ctrl+Shift+O</li>
<li>Kód formázása: Ctrl+Shift+F</li>
<li>Ha a Java Resources alatt egy package-en jobb klikk / New Class/Interfaces, akkor abba a package-be rakja az új elemet</li>
<li>Ha a nézeteket becsukjuk/átrendezzük, a default elrendezés visszaállítható: Window / Reset perspective</li>
<li>Font megnövelése (a tanári gépen hasznos):<ul>
<li>Window menü / Preferences, ott elkezdjük gépelni, hogy <em>font</em>, így megtalálja azt a beállítást, hogy Fonts and Colors</li>
<li>Azt kiválasztva, a Basic kategória alatt kell a Text Fontot kijelölni, és a méretét pl. 18-asra állítani</li>
</ul>
</li>
</ul>
<h2 id="feladat-0-adatbazis-letrehozasa">Feladat 0: Adatbázis létrehozása<a class="headerlink" href="#feladat-0-adatbazis-letrehozasa" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>Csatlakozzunk <em>Microsoft SQL Server Management Studio</em>-val a szerverhez. Ezúttal nem <em>localdb</em>-t használunk, a szerver címe: <code>localhost\sqlexpress</code>. A bejelentkezéshez <em>SQL Server Authentication</em> módot válasszuk, a felhasználónév és a jelszó is <code>sa</code>.</p>
</li>
<li>
<p>Hozzunk létre egy <code>adatvez</code> nevű adatbázist. <strong>Ügyeljünk a névre, különben a Java projektben módosítanunk kell</strong>. Az adatbázis létrehozásának mikéntjét lásd az <a href="../transactions/">első gyakorlat anyagában</a>. Ha a gépen már létezik az adatbázis, akkor nem kell újat létrehozni.</p>
</li>
<li>
<p>Futtassuk le az adatbázis inicializáló sql szkriptet az adatbázisban. Akkor is futtassuk le a szkriptet, ha már létezne az adatbázis (hogy a kezdeti állapotot visszakapjuk.)</p>
</li>
</ol>
<h2 id="feladat-1-ide-inditasa">Feladat 1: IDE indítása<a class="headerlink" href="#feladat-1-ide-inditasa" title="Permanent link">¶</a></h2>
<ol>
<li>Indítsuk el a Spring Tool Suite-ot innen: <code>c:\Work\hatteralkalmazasok\sts-4.5.1.RELEASE\SpringToolSuite4.exe</code>.</li>
<li>Indításkor megkérdezi, hova akarunk dolgozni (workspace), itt válasszuk ezt: <code>c:\Work\hatteralkalmazasok\workspaces\adatvez</code></li>
<li>Ha az indulás után a Project Explorer-ben ott van egy korábbi gyakorlatról a <strong>webshop</strong> nevű projekt, azt töröljük ki: a projekten jobb klikk / <em>Delete</em>, amikor rákérdez, pipáljuk be, hogy a fájlrendszerről is törlődjön.</li>
</ol>
<h2 id="feladat-2-projekt-importalasa">Feladat 2: Projekt importálása<a class="headerlink" href="#feladat-2-projekt-importalasa" title="Permanent link">¶</a></h2>
<ol>
<li>Töltsük le a méréshez tartozó projekt vázat!<ul>
<li>Nyissunk egy <em>command prompt</em>-ot</li>
<li>Navigáljunk el egy tetszőleges mappába, például <code>c:\work\NEPTUN</code></li>
<li>Adjuk ki a következő parancsot: <code>git clone --depth 1 https://github.com/bmeviauac01/gyakorlat-jpa-kiindulo.git</code></li>
</ul>
</li>
<li>Importáljuk a letöltött forráskódot a workspace-be:<ul>
<li>Nyissuk meg a <em>File / Import...</em>-ot</li>
<li>Kezdjük el gépelni a textboxba, hogy <em>Existing Maven Projects</em>, így rá fog szűrni erre a típusra, és válasszuk ki ezt</li>
<li>Keressük meg a letöltött webshop projektet (a <code>webshop</code> mappát a saját könyvtárunk alatt), Open Folder, utána a dialogban pipáljuk be a webshop-ot (lehet, hogy by default be lesz pipálva a pom.xml)</li>
<li>Finish</li>
</ul>
</li>
<li>
<p>Tekintsük át röviden a projektet:</p>
<ul>
<li>
<p>Ez egy <em>maven</em> alapú projekt. A maven parancssori build eszköz, ami IDE-khez is illeszthető. Fontos tulajdonsága, hogy képes a szükséges library függőségeket online repository-kból letölteni. Ha megnyitjuk a projekt gyökerében <code>pom.xml</code>-t, a maven konfig fájlját, dependency tagekben függőségeket látunk, amik (tranzitív módon) behúzzák a <em>Hibernate</em>-et mint JPA implementációt, a <em>Spring Boot</em>-ot, a <em>Spring Data</em>-t és a webréteghez szükséges <em>Spring MVC</em>-t és <em>Thymeleaf</em>-et. A laborban a maven offline működésre van konfigurálva, és előre le van töltve az összes függőség, így megelőzzük az esetleges hálózati problémákat.</p>
</li>
<li>
<p>Az <em>application.properties</em>-ben van pár alapvető beállítás, itt a DB eléréshez <strong>ellenőrizzük az adatbázis URL-t (spring.datasource.url), a usernevet (spring.datasource.username) és jelszót (spring.datasource.password)</strong>. Klasszikus Java EE alkalmazásban a <code>persistence.xml</code>-be írnánk be az adatbázis JNDI nevét, de a Spring Boot XML nélküli konfigurációt is támogat, itt ezt használjuk ki.</p>
</li>
<li>
<p>A <code>WebshopApplication</code> a Spring Boot alkalmazás belépési pontja. Egy hagyományos webalkalmazást egy külön processzben futó webkonténerre (pl. Tomcat, Jetty) kellene telepíteni. Spring Boot-os fejlesztés esetében viszont maga a Spring Boot fog elindítani egy beágyazott webkonténert (alapértelmezésben Tomcat-et).</p>
</li>
<li>
<p>A webes felület egyetlen oldal, az <code>src\main\resources\templates\testPage.html</code>. Ebbe nem fogunk majd belenyúlni. Standard html + Thymeleaf-es attribútumok láthatóak benne.</p>
</li>
<li>
<p><code>WebshopController</code>: a webréteget megvalósító controller osztály, ennek metódusai kezelik az alkalmazáshoz érkező HTTP kéréseket. Jellemzően lekérdezések eredményét akarjuk megjeleníteni az oldalon, ezért a lekérdezés eredményét a modellbe tesszük valamilyen néven, amire hivatkozni tudunk a Thymeleaf segítségével. A <code>//TODO</code> részekre kell majd bekötni az egyes feladatokat megvalósító metódusok meghívását.</p>
</li>
</ul>
</li>
</ol>
<h2 id="feladat-3-entitasok-attekintese">Feladat 3: Entitások áttekintése<a class="headerlink" href="#feladat-3-entitasok-attekintese" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>Az entitások már előre készen a <code>hu.bme.aut.adatvez.webshop.model</code> package-ben találhatók. Ezeket általában vagy kézzel írjuk meg, vagy generáljuk a DB táblákból pl. az Eclipse-es JPA plugin segítségével.</p>
</li>
<li>
<p>Az entitások közül nyissunk meg egyet, pl. <code>Vat</code>, látszik benne a <code>@Entity</code>, a <code>@Id</code> annotáció, illetve a kapcsolatok definiálására <code>@OneToMany</code> vagy <code>@ManyToOne</code></p>
</li>
<li>
<p>Az entitásokhoz a Criteria API használatakor hasznos metamodel osztályok is generálódnak, ezekből nézzünk meg egyet a <code>target\generated-sources\apt</code> alatt (A <code>pom.xml</code>-ben látható maven-processor-plugin generálja egyébként őket a build során.)</p>
</li>
</ul>
<h2 id="feladat-4-lekerdezesek">Feladat 4: Lekérdezések<a class="headerlink" href="#feladat-4-lekerdezesek" title="Permanent link">¶</a></h2>
<p>A leképzett adatmodellen fogalmazd meg az alábbi lekérdezéseket! A lekérdezéseket JPA és Spring Data használata esetén több módon is megvalósíthatjuk. Az alábbi feladatokban azt is megadjuk, milyen módon kell elkészíteni a lekérdezést, hogy mindegyikre lássunk példát.</p>
<div class="admonition important">
<p>Fontos megjegyezni, hogy ezek a módszerre vonatkozó megkötések csak oktatási szempontok miatt szerepelnek, valójában bármelyik módszerrel bármelyik lekérdezés megvalósítható lenne.</p>
</div>
<p>Az egyes feladatokat megvalósító metódusokat mindig a <code>WebshopController</code> osztály megfelelő <code>//TODO</code> kommentjeinél kell meghívni, majd a webalkalmazást futtatni és böngészőből tesztelni a
<a href="http://localhost:9080">http://localhost:9080</a> URL-en.</p>
<p><strong>a)</strong> Listázd azon termékek nevét és raktárkészletét, melyből több mint 30 darab van raktáron! Módszer: Spring Data repository interfész, metódusnévből származtatott lekérdezés.</p>
<p><strong>b)</strong> Írj olyan lekérdezést, mely kilistázza azon termékeket, melyből legalább kétszer rendeltek! Módszer: Spring Data repository custom implementációval, injektált EntityManagerrel készített JPQL query.</p>
<p><strong>c)</strong> Listázd ki a legdrágább termék adatait! Módszer: Named query, amelyet Spring Data repository-ból hívunk meg, vagy custom implementációból, injektált EntityManagerrel hívunk meg, vagy a metódusnév és query név egyezése alapján.</p>
<p>Futás közben a Console nézetben látszódnak a Hibernate által generált SQL utasítások az <em>application.properties</em>-beli <code>spring.jpa.show-sql=true</code> konfig miatt.</p>
<h3 id="futtatas">Futtatás<a class="headerlink" href="#futtatas" title="Permanent link">¶</a></h3>
<p>Jobb klikk a webshop projekten &gt; <em>Debug As / Spring Boot App</em> Ez debug módban indítja az alkalmazást, aminek hatására a beágyazott webkonténer elindul, és böngészőből a <a href="http://localhost:9080">http://localhost:9080</a> URL-en elérhető az alkalmazás. Ha ezt egyszer jobb klikkel megcsináltuk, akkor később a toolbar Debug ikonját lenyitva is megtehetjük:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="images/eclipse-run.png"><img alt="Eclipse futtatás" src="images/eclipse-run.png"/></a></p>
<p>A futó alkalmazást a <em>Console</em> nézet piros <em>Terminate</em> ikonjával lehet leállítani. Ha leállítás nélkül próbáljuk újra futtatni, akkor a második processz ütközést jelent a 9080-as porton, és leáll. Ilyenkor a sikertelen második futtatás látszik a <em>Console</em> nézetben, a <em>Terminate</em> gomb pedig inaktív, mivel ez a futás már leállt. Nyomjuk meg a Terminate ikon melletti dupla szürke X ikont, ez el fogja távolítani a már leállított futtatásokat, és csak az aktív futtatás látszik, amin viszont már tudunk <em>Terminate</em>-et nyomni.</p>
<p>Ha a teljes <em>Console</em> nézetet bezárjuk véletlenül, elő lehet szedni <em>Alt+Shift+Q, C</em> gyorsbillentyűvel, vagy <em>Window / Show View / Console</em> menüvel.</p>
<p>A leállítás utáni újrafuttatáshoz az F11-et is használhatjuk.</p>
<p>A debug módban való futtatás jellegzetessége, hogy a HTML és bizonyos Java kód módosítások azonnal életbe lépnek. (A böngészőt persze frissíteni kell.) Újra kell viszont indítani az alkalmazást, ha a Java kódban:</p>
<ul>
<li>új típust adtunk hozzá</li>
<li>annotációt adtunk hozzá/töröltünk/módosítottunk</li>
<li>új osztály- vagy tagváltozót, metódust vettünk fel</li>
<li>metódus szignatúrát módosítottunk</li>
</ul>
<p>Röviden: a metódus törzsön belüli változásokon kívül mindig újraindítás lesz szükséges.</p>
<details class="example">
<summary>Megoldás</summary>
<p><strong>4.a feladat</strong></p>
<p>Nyissuk meg a <code>dao</code> package-ben lévő <code>ProductRepository</code> interfészt, amely a Spring Data-s <code>JpaRepository</code>-ból származik (és az egyelőre üres <code>ProductRepositoryCustom</code>-ból). Találunk benne későbbi feladathoz kapcsolódó metódusokat, azokat csak figyeljük meg. Valamelyik <code>@Query</code> annotációval definiálja a futtatandó lekérdezést, valamelyiknél az is hiányzik. Nekünk sem lesz szükség <code>@Query</code> annotációra, mert a metódus neve alapján a Spring Data képes kitalálni a query-t. Tegyük tehát bele ezt az új metódust:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">hu.bme.aut.adatvez.webshop.dao</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hu.bme.aut.adatvez.webshop.model.Product</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ProductRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Product</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">ProductRepositoryCustom</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByStockGreaterThan</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">limit</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>A <code>WebshopController</code>-ben már be van injektálva egy <code>ProductRepository</code> típusú tagváltozó, hívjuk meg rajta a metódust az 4.a TODO-nál:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebshopController</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@Autowired</span>
<span class="w">  </span><span class="n">ProductRepository</span><span class="w"> </span><span class="n">productRepository</span><span class="p">;</span>

<span class="w">  </span><span class="c1">//...</span>
<span class="w">  </span><span class="c1">// 4.a feladat</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findProductsOver30</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">productRepository</span><span class="p">.</span><span class="na">findByStockGreaterThan</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>4.b feladat</strong></p>
<p>A <code>dao</code> package-ben lévő <code>ProductRepositoryCustom</code> interfészbe vegyük fel egy <code>findProductsOrderedAtLeastTwice</code> nevű metódust:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">hu.bme.aut.adatvez.webshop.dao</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">hu.bme.aut.adatvez.webshop.model.Product</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ProductRepositoryCustom</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findProductsOrderedAtLeastTwice</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>A dao package-ben lévő <code>ProductRepositoryImpl</code> osztály hibás lesz emiatt, mert nem implementálja a <code>ProductRepositoryCustom</code>-ot. Nyissuk meg az osztályt, és az osztály elején, a sor elején megjelenő kis villanykörtére kattintva belegeneráltathatjuk a nem implementált metódus vázát:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="images/eclipse-implement-methods.png"><img alt="Eclipse interfész implementálása" src="images/eclipse-implement-methods.png"/></a></p>
<p>Utána a törzsbe írhatjuk az implementációt, melynek lényege: injektált EntityManager-rel hozzuk létre és futtatjuk le a query-t. (Most látszik igazán, hogy az előző, Spring Data-s megoldás mennyi boilerplate kódot spórolt meg nekünk.)</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">hu.bme.aut.adatvez.webshop.dao</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">hu.bme.aut.adatvez.webshop.model.Product</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.EntityManager</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.PersistenceContext</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProductRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ProductRepositoryCustom</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@PersistenceContext</span>
<span class="w">  </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">em</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findProductsOrderedAtLeastTwice</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">"SELECT DISTINCT p FROM Product p "</span><span class="w"> </span><span class="o">+</span>
<span class="w">                          </span><span class="s">"LEFT JOIN FETCH p.orderitems "</span><span class="w"> </span><span class="o">+</span>
<span class="w">                          </span><span class="s">"WHERE size(p.orderitems) &gt;= :itemsMin"</span><span class="p">,</span><span class="w"> </span><span class="n">Product</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">          </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">"itemsMin"</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">          </span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Megjegyzés a megoldáshoz: az első ötletünk ez lehetne: <code>SELECT p FROM Product p WHERE size(p.orderitems) /= :itemsMin</code>. Írjuk be és próbáljuk ki előbb ezt, ilyenkor viszont <code>org.hibernate.LazyInitializationException</code> dobódik teszteléskor, mert lecsatolt állapotban akarunk kapcsolódó entitást elérni (amikor a táblázatot generálja a webréteg, és az orderitems listára hivatkozunk). Lehetséges megoldások:</p>
<ul>
<li>Az <em>application.properties</em>-ben <code>spring.jpa.open-in-view=true</code> (ez lenne amúgy a default Spring Boot esetében, de a példa projektben direkt false-ra van állítva): Ilyenkor az EntityManager már a webes kérés legelején létrejön, és csak a view renderelése után záródik be, vagyis a Spring bean-beli metódusok visszatérése után is menedzselt állapotban lenne a Product entitás, és el lehetne kérni a kapcsolódó orderitems listát.</li>
<li>vagy <code>@OneToMany(fetch=EAGER)</code> az orderitems változóra</li>
<li>vagy <em>EntityGraph</em> definiálása és annak alkalmazása a query létrehozásakor</li>
<li>vagy <code>LEFT JOIN FETCH</code>, mi ezt választottuk a fenti megoldásban. E mellé a <code>DISTINCT</code> is kell, különben minden kapcsolódó Orderitem példányra külön Product sor is lesz.</li>
</ul>
<p>A meghívás a <code>WebshopController</code>-ben triviális:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 4.b feladat</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findProductsOrderedAtLeastTwice</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// TODO</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">productRepository</span><span class="p">.</span><span class="na">findProductsOrderedAtLeastTwice</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>4.c feladat</strong></p>
<p>A <code>Product</code> osztályt nyissuk meg, ott a gyorsabb haladás érdekében már fogunk találni kész named query-ket, a másodikat kell használnunk:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@NamedQueries</span><span class="p">({</span>
<span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Product.findAll"</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="o">=</span><span class="s">"SELECT p FROM Product p"</span><span class="p">),</span>
<span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Product.findMostExpensive"</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="o">=</span><span class="s">"SELECT p FROM Product p WHERE p.price IN (SELECT MAX(p2.price) FROM Product p2)"</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
<p>A named query-t két módon is meghívhatjuk. Ha lassú a haladás, elég az első módszerrel megcsinálni. Az első módszer, hogy a named query-vel egyező nevű metódust teszünk a <code>ProductRepository</code>-ba (leszámítva a <em>Product.</em> előtagot.) Vagyis:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findMostExpensive</span><span class="p">();</span>
</code></pre></div>
<p>A másik lehetőség, hogy a <code>ProductRepositoryImpl</code>-ben, <code>EntityManager</code>-en keresztül hívjuk meg a named query-t:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findMostExpensiveProducts</span><span class="p">(){</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s">"Product.findMostExpensive"</span><span class="p">,</span><span class="w"> </span><span class="n">Product</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">getResultList</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Ilyenkor ezt a metódust ki kell még tenni a <code>ProductRepositoryCustom</code> interfészbe. Leggyorsabb így: Jobb klikk / <em>Refactor / Pull up</em>, és ott a metódus kiválasztható</p>
<p>Végül valamelyik verziót hívjuk meg a <code>WebshopController</code> megfelelő pontján:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 4.c feladat</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findMostExpensiveProducts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// TODO</span>
<span class="w">  </span><span class="c1">// return productRepository.findMostExpensiveProducts();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">productRepository</span><span class="p">.</span><span class="na">findMostExpensive</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h2 id="feladat-5-adatmodositas">Feladat 5: Adatmódosítás<a class="headerlink" href="#feladat-5-adatmodositas" title="Permanent link">¶</a></h2>
<p>A JPA nemcsak lekérdezéshez használható, hanem rajta keresztül módosítások is végrehajthatóak.</p>
<p><strong>a)</strong> Írj olyan JPQL lekérdezést a <code>ProductRepository</code> interfészbe, mely a "Building items" árát megemeli 10 százalékkal!</p>
<p><strong>b)</strong> Írj egy olyan metódust, amely létrehoz egy új kategóriát "Expensive toys" névvel, ha még nem létezik ilyen, és sorold át ide az összes olyan terméket, melynek ára, nagyobb, mint 8000 Ft!</p>
<p><strong>c)</strong> Egyszerű önálló feladat: az 5.b feladat közös megoldásában egy <code>EntityManager</code>-en keresztül lefuttatott lekérdezéssel ellenőrizzük, hogy létezik-e "Expensive toys" nevű kategória. Valósítsd meg ugyanezt a lekérdezést Spring Data repository interfészben, metódus névből származtatott lekérdezéssel, és hívd meg a megfelelő ponton.</p>
<details class="example">
<summary>Megoldás</summary>
<p><strong>5.a feladat</strong></p>
<p>A <code>ProductRepository</code> interfészben egy <em>UPDATE query</em>-t definiálunk. Azt, hogy ez módosító query, közölni kell a Spring Data-val (<code>@Modifying</code>), valamint tranzakcióba is kell tennünk <code>@Transactional</code>, az <code>org.springframework...</code> package-ből):</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Modifying</span>
<span class="nd">@Transactional</span>
<span class="nd">@Query</span><span class="p">(</span><span class="s">"UPDATE Product p SET p.price=p.price*1.1 WHERE p.id IN</span>
<span class="s">(SELECT p2.id FROM Product p2 WHERE p2.category.name=:categoryName)"</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">categoryRaisePrice</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"categoryName"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">categoryName</span><span class="p">);</span>
</code></pre></div>
<p>Meghívása a <code>WebshopController</code>-ből:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 5.a feladat</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/raisePriceOfBuildingItems"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="w"> </span><span class="p">})</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">raisePriceOfBuildingItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// TODO</span>
<span class="w">  </span><span class="n">productRepository</span><span class="p">.</span><span class="na">categoryRaisePrice</span><span class="p">(</span><span class="s">"Building items"</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"redirect:/"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Böngészőben a gomb megnyomása után a gomb alatti táblázatban látszódik az átárazás hatása.</p>
<p><strong>5.b feladat</strong></p>
<p>A <code>dao</code> package-be új osztály, <code>CategoryService</code> néven, <code>@Service</code> annotációval, szintén <code>@Transactional</code> metódussal:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CategoryService</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@PersistenceContext</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">em</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Autowired</span>
<span class="w">  </span><span class="n">ProductRepository</span><span class="w"> </span><span class="n">productRepository</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Transactional</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">moveToExpensiveToys</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">priceLimit</span><span class="p">){</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Expensive toys"</span><span class="p">;</span>
<span class="w">    </span><span class="n">Category</span><span class="w"> </span><span class="n">categoryExpensive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultList</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">"SELECT c from Category c WHERE c.name=:name"</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">getResultList</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">resultList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">      </span><span class="c1">//0 vagy null id érték esetén fog a @GeneratedValue működésbe lépni. Most primitív long az id-nk, az csak 0 tud lenni, null nem.</span>
<span class="w">      </span><span class="n">categoryExpensive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Category</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">      </span><span class="n">em</span><span class="p">.</span><span class="na">persist</span><span class="p">(</span><span class="n">categoryExpensive</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">      </span><span class="n">categoryExpensive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">expensiveProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productRepository</span><span class="p">.</span><span class="na">findByPriceGreaterThan</span><span class="p">(</span><span class="n">priceLimit</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">expensiveProducts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">categoryExpensive</span><span class="p">.</span><span class="na">addProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Figyeljük meg, hogy a menedzselt entitás példányokat (amit tranzakción belül találunk meg query-vel, vagy most persist-áltunk frissen) nem kell explicit módon visszamenteni, tranzakció végén automatikusan DB-be íródnak a memóriabeli változások.</p>
<p>Meghívás a <code>WebshopController</code>-ből:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span>
<span class="n">CategoryService</span><span class="w"> </span><span class="n">categoryService</span><span class="p">;</span>
<span class="p">...</span>

<span class="c1">// 5.b feladat</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/moveToExpensiveToys"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="w"> </span><span class="p">})</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">moveToExpensiveToys</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// TODO</span>
<span class="w">  </span><span class="n">categoryService</span><span class="p">.</span><span class="na">moveToExpensiveToys</span><span class="p">(</span><span class="mf">8000.0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"redirect:/"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Böngészőben a gomb megnyomása után látszódik a <em>Drága játékok</em> kategória tartalma</p>
<p><strong>5.c feladat</strong></p>
<p>A <code>dao</code> package-ben hozzunk létre egy új interfészt <code>CategoryRepository</code> néven, a <code>ProductRepository</code> mintájára (a Custom-os leszármazás nem kell, mert nem lesznek custom lekérdezéseink) egy metódussal:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CategoryRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Category</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="p">{</span>
<span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezután a <code>CategoryService</code> így egyszerűsödik le:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CategoryService</span><span class="w"> </span><span class="p">{</span>
<span class="p">...</span>

<span class="w">  </span><span class="nd">@Autowired</span>
<span class="w">  </span><span class="n">CategoryRepository</span><span class="w"> </span><span class="n">categoryRepository</span><span class="p">;</span>

<span class="w">  </span><span class="nd">@Transactional</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">moveToExpensiveToys</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">priceLimit</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categoryRepository</span><span class="p">.</span><span class="na">findByName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//  ...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h2 id="feladat-6-tarolt-eljarasok-hasznalata">Feladat 6: Tárolt eljárások használata<a class="headerlink" href="#feladat-6-tarolt-eljarasok-hasznalata" title="Permanent link">¶</a></h2>
<p>Hívd meg a JPA-ból a <em>CreateNewPaymentMethod</em> nevű tárolt eljárást, mely új fizetési mód rögzítésére szolgál, és visszaadja az új rekord azonosítóját!</p>
<ul>
<li>
<p>Az SQL Server Management Studioban ellenőrizzük, hogy az adatbázis tartalmazza-e a <em>CreateNewPaymentMethod</em> nevű tárolt eljárást!</p>
</li>
<li>
<p>Ha nem, akkor az alábbi kódot futtasd le a Management Studioban a tárolt eljárás létrehozásához!</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">CreateNewPaymentMethod</span>
<span class="p">(</span>
<span class="o">@</span><span class="k">Method</span><span class="w"> </span><span class="n">nvarchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="o">@</span><span class="n">Deadline</span><span class="w"> </span><span class="nb">int</span>
<span class="p">)</span>
<span class="k">AS</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">PaymentMethod</span>
<span class="k">values</span><span class="p">(</span><span class="o">@</span><span class="k">Method</span><span class="p">,</span><span class="o">@</span><span class="n">Deadline</span><span class="p">)</span>
<span class="k">select</span><span class="w"> </span><span class="n">scope_identity</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NewId</span>
</code></pre></div>
</li>
</ul>
<details class="example">
<summary>Megoldás</summary>
<p>A <code>PaymentMethod</code> entitáson megtaláljuk az alábbi annotációt. Vessük össze a tárolt eljárást definiáló kóddal a változó neveket!</p>
<div class="highlight"><pre><span></span><code><span class="nd">@NamedStoredProcedureQueries</span><span class="p">({</span>
<span class="w">  </span><span class="nd">@NamedStoredProcedureQuery</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"createMethodSP"</span><span class="p">,</span>
<span class="w">      </span><span class="n">procedureName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"CreateNewPaymentMethod"</span><span class="p">,</span>
<span class="w">      </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nd">@StoredProcedureParameter</span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParameterMode</span><span class="p">.</span><span class="na">IN</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Method"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">            </span><span class="nd">@StoredProcedureParameter</span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParameterMode</span><span class="p">.</span><span class="na">IN</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Deadline"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">          </span><span class="p">})</span>
<span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Paymentmethod</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="p">...</span>
</code></pre></div>
<p>A named stored procedure query meghívható Spring Data repositoryból (<code>dao</code> package-en <em>New Interface ... / PaymentmethodRepository</em>):</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">PaymentmethodRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Paymentmethod</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@Procedure</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"createMethodSP"</span><span class="p">)</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">newMethod</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">"Method"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">"Deadline"</span><span class="p">)</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">deadline</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Spring Data nélkül így menne, <code>EntityManager</code>-en keresztül, erre valószínűleg már nem lesz idő:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PaymentmethodService</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@PersistenceContext</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">EntityManager</span><span class="w"> </span><span class="n">em</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createNewMethod</span><span class="p">(</span><span class="n">Paymentmethod</span><span class="w"> </span><span class="n">paymentMethod</span><span class="p">){</span>
<span class="w">    </span><span class="n">StoredProcedureQuery</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createNamedStoredProcedureQuery</span><span class="p">(</span><span class="s">"createMethodSP"</span><span class="p">);</span>
<span class="w">    </span><span class="n">sp</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">"Method"</span><span class="p">,</span><span class="w"> </span><span class="n">paymentMethod</span><span class="p">.</span><span class="na">getMethod</span><span class="p">());</span>
<span class="w">    </span><span class="n">sp</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">"Deadline"</span><span class="p">,</span><span class="w"> </span><span class="n">paymentMethod</span><span class="p">.</span><span class="na">getDeadline</span><span class="p">());</span>
<span class="w">    </span><span class="n">sp</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A webrétegbeli meghívás:</p>
<ul>
<li>Injektáljuk a <code>WebshopController</code>-be a <code>PaymentmethodRepository</code> interfészt:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@Autowired</span>
<span class="n">PaymentmethodRepository</span><span class="w"> </span><span class="n">paymentmethodRepository</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>
<p>A WebshopController utolsó TODO-jánál hívjuk meg</p>
<div class="highlight"><pre><span></span><code><span class="n">paymentmethodRepository</span><span class="p">.</span><span class="na">newMethod</span><span class="p">(</span><span class="n">paymentMethod</span><span class="p">.</span><span class="na">getMethod</span><span class="p">(),</span><span class="w"> </span><span class="n">paymentMethod</span><span class="p">.</span><span class="na">getDeadline</span><span class="p">());</span>
</code></pre></div>
</li>
<li>
<p>A <code>Paymentmethod</code> entitás <code>deadline</code> és <code>method</code> tagváltozóin validációs <em>constraint</em>-eket találunk. Ezek az annotációk a <em>Bean Validation API</em> részei, amivel a webes rétegben használt Spring MVC, de a JPA és integrálódik, így a webrétegbeli és adatrétegbeli validáció konzisztens módon, redundanciamentesen definiálható.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@NotNull</span>
<span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">deadline</span><span class="p">;</span>

<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"METHOD"</span><span class="p">)</span>
<span class="nd">@NotEmpty</span>
<span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">method</span><span class="p">;</span>
</code></pre></div>
</li>
</ul>
</details>
<hr/>
<div class="md-source-file">
<span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
</path>
</svg>
</span>
<span title="2022. december 5. 12:56:45">
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2022-12-05T12:56:45+01:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-12-05</span>
</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Létrehozva"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z">
</path>
</svg>
</span>
<span title="2020. július 9. 18:46:22">
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2020-07-09T18:46:22+02:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2020-07-09</span>
</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Szerzők">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
</path>
</svg>
</span>
<span>Szerzők</span>
<nav><a class="md-author" href="https://github.com/akosdudas" rel="noopener noreferrer" target="_blank" title="@akosdudas">
<img alt="@akosdudas" src="https://avatars.githubusercontent.com/u/11335181?size=72"/>
</a><a class="md-author" href="https://github.com/gergoradeczki" rel="noopener noreferrer" target="_blank" title="@gergoradeczki">
<img alt="@gergoradeczki" src="https://avatars.githubusercontent.com/u/4851436?size=72"/>
</a><a class="md-author" href="https://github.com/MeIidon" rel="noopener noreferrer" target="_blank" title="@MeIidon">
<img alt="@MeIidon" src="https://avatars.githubusercontent.com/u/56506014?size=72"/>
</a><a class="md-author" href="https://github.com/imre-gabor" rel="noopener noreferrer" target="_blank" title="@imre-gabor">
<img alt="@imre-gabor" src="https://avatars.githubusercontent.com/u/6803403?size=72"/>
</a><a class="md-author" href="https://github.com/abdullahmusa" rel="noopener noreferrer" target="_blank" title="@abdullahmusa">
<img alt="@abdullahmusa" src="https://avatars.githubusercontent.com/u/63659188?size=72"/>
</a></nav>
</span>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Vissza a tetejére
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © BME VIK AUT
    </div>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest", "content.action.edit"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
<script src="../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
<script src="../../js/timeago.min.js"></script>
<script src="../../js/timeago_mkdocs_material.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>